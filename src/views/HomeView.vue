<template>
  <h1>{{ category }}</h1>
  <p>{{ wordToTranslate }}</p>
  <AnswerItems @button-clicked="checkAnswer" :answers="answers" />
  <p v-if="answeredCorrectly && answeredQuestion">Correct answer!</p>
  <p v-else-if="answeredQuestion && !answeredCorrectly">Wrong answer</p>
  <button v-show="answeredQuestion" @click.prevent="nextQuestion">
    Next question
  </button>
</template>

<script setup>
import AnswerItems from "../components/AnswerItems.vue";
import { ref, onMounted } from "vue";
import { useQuizStore } from "@/stores/quiz";
const answers = ref([]);
const wordToTranslate = ref("");
const category = ref("");
const quiz = useQuizStore();
const correctAnswer = ref("");
const currentQuestion = ref();
const answeredQuestion = ref(false);
const answeredCorrectly = ref(false);

const checkAnswer = (answer) => {
  answeredQuestion.value = true;

  if (answer === correctAnswer.value) {
    answeredCorrectly.value = true;
  } else {
    answeredCorrectly.value = false;
  }
};

const setQuestionInfo = () => {
  console.log("Kevins log", currentQuestion.value);
  wordToTranslate.value = currentQuestion.value.word;
  correctAnswer.value = currentQuestion.value.correctAnswer;
  answers.value = [];
  answers.value = [...answers.value, currentQuestion.value.correctAnswer];
  answers.value = [
    ...answers.value,
    currentQuestion.value.incorrectAnswers[0].word,
  ];

  answers.value = [
    ...answers.value,
    currentQuestion.value.incorrectAnswers[1].word,
  ];
};

const nextQuestion = () => {
  if (quiz.idCurrentQuestion < quiz.numberOfQuestions - 1) {
    quiz.nextQuestion();
    currentQuestion.value = quiz.getCurrentQuestion();
    setQuestionInfo();

    answeredQuestion.value = false;
    answeredCorrectly.value = false;
  } else {
    // Here we will send the user to the finish/result page.
    console.log("done");
  }
};

onMounted(() => {
  //Set information about quiz (Now hard coded in quiz.js)
  fetch("questions.json")
    .then((response) => response.json())
    .then((data) => {
      console.log(data);
      quiz.setQuestions(data.questions);

      category.value = quiz.category;

      //Set first question
      currentQuestion.value = quiz.getCurrentQuestion();
      console.log("Kevins log2", quiz.getCurrentQuestion());
      setQuestionInfo();
    });
  // Beh√∂ver ingen getter utan computed
});
</script>
